
```{r}

whisky_profiles <- whisky %>%
  filter(Owner == "Diageo")
# summarise(average = mean(strength)) %>% 
  # mutate(flavour_dimension = case_when(flavour %in% rich ~ "richness",
  #                                      flavour %in% smoke ~ "smoke_and_spice",
  #                                      flavour %in% delicate ~ "delicate",
  #                                      flavour %in% light ~ "light",
  #                                      TRUE ~ as.character(flavour))

      group_by(Region, info, flavour_dimension) %>%
           summarise(flavour_strength = sum(strength)) %>%
    ungroup() %>% 
  pivot_wider(names_from = flavour_dimension, values_from = flavour_strength) %>% 
  mutate(smoke = smoke_and_spice - light,
         roundness = richness - delicate)


whisky_profiles %>%
   ggplot() +
  aes(x = roundness , y = smoke, colour = Region) +
    geom_point() +
geom_jitter() + 
  geom_text_repel(aes(label = info),
                  # box.padding   = 0.35, 
                  # point.padding = 0.5,
                  # segment.color = 'grey50',
                  size = 2) +
  theme(legend.position = "bottom")
# xlim(25, 80) +
#   ylim(0, 50)
  
ggsave("asdas.png")
  
  # geom_text_repel(aes(label = info)) + # geom_label_repel()
  # xlim(25, 80) +
#   # ylim(0, 50) +
#  # 
#   xlab("Richness") +
#   ylab("Smokiness and Spice")
#   
#   +

# mtcars
## , point.padding = NA   axis.text = element_blank()

```
Testing correlation between different flavours
```{r message=FALSE, warning=FALSE}
tidy_whisky %>%
    pivot_wider(names_from = flavour, values_from = strength) %>%
    select(Region, Body:Floral ) %>%
    dummy_cols() %>% 
ggpairs(columns = c(2:15),
                aes(colour = Region, alpha = 0.5))

 mutate(flavour_dimension = case_when(flavour %in% rich ~ "richness",
                                       flavour %in% smoke ~ "smoke_and_spice",
                                       flavour %in% delicate ~ "delicate",
                                       flavour %in% light ~ "light",
                                       TRUE ~ as.character(flavour)))
 
 
 whisky %>% 
   filter(Distillery %in% c("Ardbeg", "Linkwood", "Springbank", "Glenkinchie")) %>%
  select(Distillery, Body:Floral)
 
 
whisky %>% 
filter(Region == "Islay") %>% 
  select(Distillery, Body:Floral)


 
smoke <- c("Body", "Smoky", "Medicinal")
delicate<- c("Floral", "Fruity","Winey")
rich <- c("Tobacco","Sweetness", "Malty")
light <- c("Spicy","Nutty","Honey")
```
```{r}
tidy_whisky %>%
  filter(headline == "Distillery") %>% 
# summarise(average = mean(strength)) %>% 
  mutate(flavour_dimension = case_when(flavour %in% rich ~ "richness",
                                       flavour %in% smoke ~ "smoke_and_spice",
                                       flavour %in% delicate ~ "delicate",
                                       flavour %in% light ~ "light",
                                       TRUE ~ as.character(flavour))) %>% 
     group_by(Region, info, flavour, flavour_dimension)

%>%
    #        # summarise(flavour_strength = sum(strength)) %>%
    # ungroup() %>%
  pivot_wider(names_from = flavour_dimension, values_from = flavour_strength) %>%
  mutate(smoke = smoke_and_spice - light,
         roundness = richness - delicate) %>% 
  filter(Region == "Islay")
```

```{r}
library(glmulti)

glmulti_fit <- glmulti(
  y = Region,
  xr = c("Body:Floral"),
  data = whisky,
  level = 2, # 2 = include pairwise interactions, 1 = main effects only (main effect = no pairwise interactions)
  minsize = 0, # no min size of model
  maxsize = -1, # -1 = no max size of model
  marginality = TRUE, # marginality here means the same as 'strongly hierarchical' interactions, i.e. include pairwise interactions only if both predictors present in the model as main effects.
  method = "g", # the problem is too large for exhaustive search, so search using a genetic algorithm
  crit = bic, # criteria for model selection is BIC value (lower is better)
  plotty = FALSE, # don't plot models as function runs
  report = TRUE, # do produce reports as function runs
  confsetsize = 100, # return best 100 solutions
  fitfunction = lm # fit using the `lm` function
)

?glmulti
```

```{r}
library(rpart)
library(rpart.plot)
library(dplyr)

whisky_fit <- rpart(Region ~ ., 
                     data = tidy_whisky, 
                     method = 'class')

rpart.plot(whisky_fit)
```

Testing negative correlation between smoky and floral, body and 
```{r}
tidy_whisky %>%
    filter(headline == "Distillery",
           info == "Laphroaig") %>% 
    select(flavour, strength) %>% 
    distinct()
    
```
```{r}
tidy_whisky %>%
    filter(headline == "Distillery",
           info == "Clynelish") %>% 
    select(flavour, strength) %>% 
    distinct()
```
```{r}
tidy_whisky %>%
    filter(headline == "Distillery",
           info == "Lagavulin") %>% 
    select(flavour, strength) %>% 
    distinct()
```

```{r}
regional_palette %>%
    ggplot() +
    aes(x = region, y = smoky, fill = region) +
    geom_col()
```

Main Charts

selectinputs for multiple regional flavours - polygon
leaflet for regional distilleries
bar chart for each flavour dimension and regional selection


```{r}




```
secondary charts
preferred user flavour profile providing suggested whiskys
interactive scatter chart of distilleries x = 'delicateproxy to full bodied' y = smoky to 'not-smokyproxy'




```{r}

```

charts that need more consideration
latitude longitude for 'average' regional distillery location
'expected' flavour profiles with latitude / longitude